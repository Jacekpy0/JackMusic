<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JackMusic</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        h1 {
            text-align: center;
            padding: 20px;
            background-color: #0078d7;
            color: white;
            margin: 0;
        }

        #app-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #music-list div, #playlist-songs div {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        button {
            padding: 5px 10px;
            font-size: 14px;
            background-color: #0078d7;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #005a9e;
        }
    </style>
</head>
<body>
    <h1>JackMusic</h1>
    <div id="app-container">
        <div id="user-profile">
            <h2>Witaj, <span id="username">Anonim</span></h2>
            <button onclick="logout()">Wyloguj się</button>
        </div>
        <div id="playlist">
            <h2>Twoja playlista</h2>
            <div id="playlist-songs"></div>
        </div>
        <div id="music-list">
            <h2>Dostępne utwory</h2>
        </div>
        <audio id="audio-player" controls></audio>
    </div>

    <script>
        let currentUser = null;
        let musicList = [];

        // Funkcja ładująca dane użytkownika
        async function loadUserData(username) {
            const response = await fetch('users.json');
            const users = await response.json();
            currentUser = users.find(user => user.username === username);
            if (!currentUser) {
                alert("Nie znaleziono użytkownika.");
                return;
            }
            document.getElementById('username').textContent = currentUser.username;
            loadPlaylist();
            loadMusic();
        }

        // Funkcja ładująca playlistę użytkownika
        async function loadPlaylist() {
            const response = await fetch('playlists.json');
            const playlists = await response.json();
            const userPlaylist = playlists.find(playlist => playlist.owner === currentUser.username);
            displayPlaylist(userPlaylist ? userPlaylist.songs : []);
        }

        // Funkcja wyświetlająca playlistę
        function displayPlaylist(playlistSongs) {
            const playlistElement = document.getElementById('playlist-songs');
            playlistElement.innerHTML = '';
            playlistSongs.forEach(songTitle => {
                const song = musicList.find(m => m.title === songTitle);
                if (song) {
                    const songElement = document.createElement('div');
                    songElement.innerHTML = `
                        <strong>${song.title}</strong> - ${song.artist}
                        <button onclick="playMusic('${song.file}')">Odtwórz</button>`;
                    playlistElement.appendChild(songElement);
                }
            });
            currentUser.playlist = playlistSongs;
        }

        // Funkcja ładująca dostępne utwory
        async function loadMusic() {
            const response = await fetch('music.json');
            musicList = await response.json();
            displayMusicList(musicList);
        }

        // Funkcja wyświetlająca listę dostępnych utworów
        function displayMusicList(music) {
            const musicListElement = document.getElementById('music-list');
            musicListElement.innerHTML = '';
            music.forEach(song => {
                const songElement = document.createElement('div');
                songElement.innerHTML = `
                    <strong>${song.title}</strong> - ${song.artist}
                    <button onclick="addToPlaylist('${song.title}')">Dodaj do playlisty</button>`;
                musicListElement.appendChild(songElement);
            });
        }

        // Funkcja dodająca utwór do playlisty
        async function addToPlaylist(songTitle) {
            if (!currentUser.playlist) {
                currentUser.playlist = [];
            }
            if (currentUser.playlist.includes(songTitle)) {
                alert("Ten utwór jest już na twojej playliście!");
                return;
            }
            currentUser.playlist.push(songTitle);
            displayPlaylist(currentUser.playlist);

            // Zapisanie zmian do playlists.json
            const response = await fetch('playlists.json');
            const playlists = await response.json();
            const existingPlaylist = playlists.find(playlist => playlist.owner === currentUser.username);
            if (existingPlaylist) {
                existingPlaylist.songs = currentUser.playlist;
            } else {
                playlists.push({ owner: currentUser.username, songs: currentUser.playlist });
            }
            await savePlaylists(playlists);
        }

        // Funkcja zapisująca zmiany w playlists.json
        async function savePlaylists(playlists) {
            await fetch('save-playlists.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(playlists)
            });
        }

        // Funkcja odtwarzająca utwór
        function playMusic(songFile) {
            const player = document.getElementById('audio-player');
            player.src = songFile;
            player.play();
        }

        // Funkcja wylogowania
        function logout() {
            currentUser = null;
            document.getElementById('username').textContent = "Anonim";
            document.getElementById('playlist-songs').innerHTML = '';
            document.getElementById('music-list').innerHTML = '';
        }

        // Ładowanie danych użytkownika
        loadUserData('testuser');
    </script>
</body>
</html>